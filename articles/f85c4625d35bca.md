---
title: "useStateを使って電卓を作成する"
emoji: "👌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["React"]
published: false
---

# 電卓を作成する
今回はReact(JSX)で電卓をゼロから作成しました。
途中苦戦しましたが、何とか作成できたのでログを残しておきます。


# UIを作成する
電卓といえば、ボタンを思い浮かべる方が多いと思います。
ボタンを配置する際に、横に並んだボタンのレイヤーが縦に積み重なっている（縦に並んでいる）と考えます。
```jsx
    <div>
            <div className="display">
                <p>{number}</p>
            </div>
            <div className="container">
                <div className="button-layer1">
                    <button onClick={() => handleClickDigit(7)}>7</button>
                    <button onClick={() => handleClickDigit(8)}>8</button>
                    <button onClick={() => handleClickDigit(9)}>9</button>
                    <button onClick={handleClickDivide}>/</button>
                </div>
                <div className="button-layer2">
                    <button onClick={() => handleClickDigit(4)}>4</button>
                    <button onClick={() => handleClickDigit(5)}>5</button>
                    <button onClick={() => handleClickDigit(6)}>6</button>
                    <button onClick={handleClickMultiply}>*</button>
                </div>
                <div className="button-layer3">
                    <button onClick={() => handleClickDigit(1)}>1</button>
                    <button onClick={() => handleClickDigit(2)}>2</button>
                    <button onClick={() => handleClickDigit(3)}>3</button>
                    <button onClick={handleClickMinus}>-</button>
                </div>
                <div className="button-layer4">
                    <button onClick={() => handleClickDigit(0)}>0</button>
                    <button onClick={() => setNumber(number + '.')}>.</button>
                    <button onClick={handleClickEquall}>=</button>
                    <button onClick={handleClickPlus}>+</button>
                </div>
                <div className="button-layer4">
                    <button onClick={handleClickAC}>AC</button>
                    <button onClick={handleClickDelite}>▶</button>
                </div>
            </div>
        </div>
```


# 数字の表示
数字の表示には React の state（状態）を使いました。
単なるローカル変数だけだと、再レンダリングのたびに値がリセットされてしまうため、ボタンをクリックしても表示が更新され続けません。
```JSX
const [number, setNumber] = useState(0);
const [prevNumber, setPrevNumber] = useState(0);
```
number: 画面に表示している現在の数値

prevNumber: 演算子ボタン（+, -, など）を押した時点の数値

例えば「12 + 3」のような計算では、
1. 2 を入力 → number に入る
2. + を押す → prevNumber に 12 を保存し、number を 0 にリセット
3. を入力 → number に 3 が入る
4. = を押す → prevNumber と number を使って計算
という流れになります。

数字ボタンは重複していたロジックを handleClickDigit にまとめました。
```JSX
const handleClickDigit = (digit) => {
  if (number === 0) {
    setNumber(digit);
  } else {
    const connectNumber = String(number) + String(digit);
    setNumber(Number(connectNumber));
  }
};
```
最初の入力だけは 0 を上書き
2 桁目以降は、文字列として結合してから Number() で数値に戻す


# 四則演算の実装
最初は「plus 用 state」「minus 用 state」のように、演算子ごとにフラグを持たせていましたが、状態が増えすぎてロジックが複雑になってしまいました。

そこで、どの演算子が選ばれているかだけを 1 つの state で持つようにしました。
```JSX
const [operator, setOperator] = useState(null); 
// null | '+' | '-' | '*' | '/'

const handleClickPlus = () => {
  setPrevNumber(Number(number));
  setNumber(0);
  setOperator("+");
};

const handleClickMinus = () => {
  setPrevNumber(Number(number));
  setNumber(0);
  setOperator("-");
};

// 省略: ×, ÷ も同様
```
= ボタンでは、operator の値に応じて四則演算を切り替えています。
```JSX
//イコールボタンクリック時の処理
    const handleClickEquall = () => {
        let amount = 0;
        if(operator === '+') {
             amount = (prevNumber + Number(number));
        }
         else if(operator === '-') {
             amount = (prevNumber - Number(number));
        }
        else if(operator === '*') {
            amount = (prevNumber * Number(number));
        }
        else if(operator === '/') {
            amount = (prevNumber / Number(number));
        }
        setNumber(amount);
    }
```
演算子ごとに関数や state を増やすのではなく、
「いま選ばれている演算子」だけを operator に持たせることで、イコールの処理を 1 か所に集約できたのがポイントです。


# 文字の削除
最後に苦戦したのが、表示中の数字を「後ろから 1 桁だけ削除する」処理です。
最初はそのまま数値を操作しようとしてうまくいかなかったので、以下のように整理しました。
- 数値と文字列の扱いを分ける
- Javascriptの標準関数を使用する

結果として以下のようなロジックで正しく動作させることができました。
```JSX
//削除ボタンクリック時の処理（後ろから削除）
    const handleClickDelite = () => {
        //数値を文字列に変換
        const str = String(number);

        //1桁以下なら0表示にする
        if(str.length <= 1) {
            setNumber(0);
            return;
        } 
        //それ以外なら後ろの文字を削除する
        else {
            const newStr = str.slice(0,-1);

            //数値に変換して再度代入
            setNumber(Number(newStr));
        }
    }
```

## 数値と文字列の整理
number は state としては数値で扱っているが、
桁数の判定や 1 桁削除は文字列の方がやりやすい
ということで、一度 String(number) で文字列に変換してから .length や .slice() を使うようにしています。

## Javascriptの標準関数を使用する
- Number(value)：値を数値型に変換
- String(value)：値を文字列型に変換
- "text".slice(start, end)：start 以上 end 未満の部分文字列を取り出す
slice(0, -1) とすると「末尾 1 文字を除いた文字列」になる

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/String/slice